var EventsManager={draggingElt:null,overElt:null,dragging:false,draggables:[],droppables:[],gap:{x:0,y:0},EVENT_DOWN:CM.isiOS?"touchstart":"mousedown",EVENT_UP:CM.isiOS?"touchend":"mouseup",EVENT_MOVE:CM.isiOS?"touchmove":"mousemove",EVENT_OVER:CM.isiOS?"touchstart":"mouseover",EVENT_OUT:CM.isiOS?"touchstart":"mouseout",EVENT_CHANGE:"change",checkIntersectsInterval:null,dblclickTimeout:null,addDroppable:function(a){this.droppables.push(a)},addDraggable:function(a){this.draggables.push(a)},emptyElements:function(){if(this.draggables.length){this.draggables.splice(0,this.draggables.length)}if(this.droppables.length){this.droppables.splice(0,this.droppables.length)}},setDraggingElement:function(a,b){this.draggingElt=a;var c=a.jQueryElt.offset();this.gap={x:b.pageX-c.left,y:b.pageY-c.top};this.parentOffset=a.jQueryElt.offsetParent().offset()},toggleDragging:function(){this.dragging=!this.dragging},checkIntersect:function(){Console.log(this.draggingElt);var e=null,j=this.draggingElt.jQueryElt,b=j.position().left,a=b+this.draggingElt.width,h=j.position().top,g=h+this.draggingElt.height,k=x21=y11=y21=0,f=this.overElt,l=false;this.overElt=null;for(var d=0,c=this.droppables.length;d<c;d++){e=this.droppables[d];if(this.draggingElt!==e&&e.dropEnabled){k=e.position.x1,x21=e.position.x2,y11=e.position.y1,y21=e.position.y2;if((a>(k+20)&&b<k)||(b>k&&b<(x21-20))){if((h>y11&&h<y21)||(h<y11&&g>y11)){this.overElt=e;Console.log("colision over: "+e);l=true}}}}return l},initIntersect:function(){this.checkIntersectsInterval=setInterval(jQuery.proxy(this.checkIntersect,this),100)},clearIntersect:function(){Console.log("clearIntersect()");clearInterval(this.checkIntersectsInterval);this.checkIntersectsInterval=null},preventTouchDefaults:function(){if(CM.isiOS){jQuery("body").bind(this.EVENT_MOVE+" "+this.EVENT_UP+" "+this.EVENT_DOWN,function(a){a.preventDefault()})}},init:function(){var c=this;this.preventTouchDefaults();var a=jQuery.proxy(function(e){if(!this.draggingElt){return}var d=this.draggingElt;if(this.dragging){this.dragging=false;if(this.checkIntersect()){d.onStoppedDragging();this.overElt.onOut(d);this.overElt.onDropping(d)}else{if(d.onCancelDragging){d.onCancelDragging()}}}else{if(this.dblclickTimeout===null){if(d.onClick){d.onClick()}this.dblclickTimeout=setTimeout(function(){c.dblclickTimeout=null},DBLCLICK_DELAY)}else{if(d.onDoubleClick){d.onDoubleClick()}}}this.draggingElt=null},c);$(document).bind(this.EVENT_UP,a);var b=jQuery.proxy(function(f){if(!this.draggingElt||!this.draggingElt.dragEnabled){return}var d=this.draggingElt;if(!this.dragging){this.dragging=true;if(d.onStartDragging){d.onStartDragging()}}else{if(d.onDragging){if(CM.isiOS){var g=f.originalEvent.touches[0]}else{var g=f.originalEvent}d.onDragging(g.pageX-this.gap.x-this.parentOffset.left,g.pageY-this.gap.y-this.parentOffset.top)}}},this);$(document).bind(this.EVENT_MOVE,b)}};