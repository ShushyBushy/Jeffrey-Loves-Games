var Console=function(){var a=jQuery("<div/>").attr("id","debugConsole").hide(),b=!0;return{init:function(){jQuery(document).ready(function(){a.bind(EventsManager.EVENT_DOWN,function(){Console.reduce();return!1});jQuery("body").append(a)})},reduce:function(){b=!b;a.css({top:b?"":"0",height:b?"30px":"100%",bottom:b?"0":""})},log:function(b){if(typeof b==="object"){a.prepend("<br />");for(var d in b)b.hasOwnProperty(d)&&a.prepend("&nbsp;"+d+": "+b[d]+"<br />");a.prepend("<strong>Object</strong><br />")}else a.prepend(b+
"<br /><br />")},clear:function(){a.html("")}}}();var CM={phoneType:"",screenHeight:0,emulator:!1,env:"dev",trueModelName:"",isiOS:!1,isPlaybook:!1,twitterURL:"http://twitter.com/home?status=",init:function(){typeof Mojo!="undefined"?(this.phoneType=Mojo.Environment.DeviceInfo.screenHeight<480?"pixi":"pre",this.screenHeight=screen.height,this.emulator=Mojo.Environment.DeviceInfo.modelName==="(Device)"?!0:!1,this.trueModelName=Mojo.Environment.DeviceInfo.modelName):(this.phoneType="hd",this.screenHeight=768,this.emulator=!0,this.trueModelName="(Device)",
this.isiOS=navigator.userAgent.match(/iPhone|iPod|iPad|PlayBook/)!==null,this.isPlaybook=navigator.userAgent.match(/PlayBook/)!==null);Console.init()},debug:function(){Console.log("["+this.phoneType+"] h="+this.screenHeight+"px, emu="+this.emulator+" ("+this.trueModelName+")")}};CM.init();var ST_STOPPED=3,ST_PAUSED=4,MAX_SCORES=4,StateManager={options:{},db:null,status:{status:ST_STOPPED,date:(new Date).toUTCString(),gamesTotal:0,gamesWon:0,scoreTotal:0},gameOptions:{sound:!1,background:0,cardset:0,theme:"fantasy",autoFlip:!0,autoPlay:!1},scores:[{nick:"Leo",score:"460",time:{h:0,m:1,s:10},location:"London",date:(new Date).toUTCString()},{nick:"Nard",score:"340",time:{h:0,m:2,s:0},location:"New-York",date:(new Date).toUTCString()},{nick:"Warp",score:"320",time:{h:0,m:1,s:45},location:"Zurick",
date:(new Date).toUTCString()},{nick:"Leo",score:"300",time:{h:0,m:2,s:15},location:"Paris",date:(new Date).toUTCString()}],version:0,gameState:null,initCallback:null,scoresCallback:null,init:function(a,b){this.options={name:"WarpKlondike",version:a,displayName:"WarpKlondike",replace:!1};this.version=a;if(typeof b!=="undefined")this.initCallback=b;try{this.db=new Lawnchair(this.options.name)}catch(c){this.db=null}if(this.db!==null)this.onDepotOpened();else this.initCallback&&this.initCallback(this.gameOptions,
this.scores)},clearDB:function(){this.db!==null&&this.db.nuke()},getStatus:function(){return this.status},setStatus:function(a){this.saveStatus(a)},setScore:function(a,b){if(b>MAX_SCORES-1||b<0)return!1;else this.scores[b]=a,this.saveScores()},getGameOptions:function(){return this.gameOptions},setGameOptions:function(a){this.gameOptions=a},setGameOption:function(a,b){this.gameOptions[a]=b},getGameOption:function(a){return this.gameOptions[a]},loadStatus:function(){this.db!==null&&typeof this.db!==
"undefined"&&this.db.get("status",jQuery.proxy(this.onLoadStatus,this))},loadGameOptions:function(){this.db!==null&&typeof this.db!=="undefined"&&this.db.get("gameOptions",jQuery.proxy(this.onLoadGameOptions,this))},loadScores:function(){this.db!==null&&typeof this.db!=="undefined"&&this.db.get("scores",jQuery.proxy(this.onLoadScores,this))},saveScores:function(){this.db!==null&&typeof this.db!=="undefined"&&this.db.save({key:"scores",value:this.scores},function(){})},saveStatus:function(a){var b=
this;this.status=a;this.db!==null&&typeof this.db!=="undefined"&&this.db.save({key:"status",value:a},function(c){if(c!==null)b.status=a})},saveGameOptions:function(){this.db!==null&&typeof this.db!=="undefined"&&this.db.save({key:"gameOptions",value:this.gameOptions},function(){})},loadState:function(a){this.db!==null&&typeof this.db!=="undefined"&&this.db.get("saveGame",a)},saveState:function(a){this.db!==null&&typeof this.db!=="undefined"&&this.db.save({key:"saveGame",value:a},function(){})},removeState:function(){this.db!==
null&&typeof this.db!=="undefined"&&this.db.remove("saveGame",function(){})},onLoadSaveGame:function(a){return a!==null?a.value:null},onLoadStatus:function(a){a!==null?this.status=a.value:(this.saveStatus(this.status),this.removeState())},onLoadGameOptions:function(a){a!==null?this.gameOptions=a.value:this.saveGameOptions(this.gameOptions);this.initCallback!==null&&this.initCallback(this.gameOptions,this.status,this.scores)},onLoadScores:function(a){a!==null?this.scores=a.value:this.saveScores(this.scores);
this.loadGameOptions()},onDepotOpened:function(){this.loadStatus();this.loadScores()},onFailure:function(){}};var SND_SHUFFLE=0,SND_FLICK_CARD=1,SND_CLICK_CARD=2,SND_DECK=3,SND_BLANK=6,SND_SPLASH=5,SND_YOU_WIN=4,SND_GAME=7,SND_MENU=8,SND_FLIP_CARD=9,SoundManager={soundList:[{src:"audio/shuffleCards.mp3",loop:!1,elt:null},{src:"audio/flickCard.mp3",loop:!1,elt:null},{src:"audio/clickCard.mp3",loop:!1,elt:null},{src:"audio/deck.mp3",loop:!1,elt:null},{src:"audio/wellDone.mp3",loop:!1,elt:null}],soundActive:!0,init:function(){if(typeof Audio==="undefined")this.soundActive=!1;else for(var a=0;a<this.soundList.length;a++)audioElt=
new Audio,audioElt.src=this.soundList[a].src,audioElt.load(),this.soundList[a].elt=audioElt},isSoundReady:function(a){return a<this.soundList.length&&this.soundList[a].elt!==null},playSound:function(a){this.isSoundReady(a)&&game.gameOptions.sound===!0&&this.soundList[a].elt.play()},pauseSound:function(a){this.isSoundReady(a)&&this.soundList[a].elt.pause()}};var TimerManager={time:{h:0,m:0,s:0},timeInterval:null,callback:null,init:function(a){this.callback=a},start:function(a){this.time={h:a.h,m:a.m,s:a.s};this.timeInterval=setInterval(jQuery.proxy(TimerManager.setTime,TimerManager),1E3)},stop:function(){if(this.timeInterval!==null)clearInterval(this.timeInterval),this.time={h:0,m:0,s:0}},setTime:function(){this.time.s++;if(this.time.s===60)this.time.m++,this.time.s=0;if(this.time.m===60)this.time.h++,this.time.m=0;this.callback&&this.callback(this.time)}};var EventsManager={draggingElt:null,overElt:null,dragging:!1,draggables:[],droppables:[],gap:{x:0,y:0},EVENT_DOWN:CM.isiOS?"touchstart":"mousedown",EVENT_UP:CM.isiOS?"touchend":"mouseup",EVENT_MOVE:CM.isiOS?"touchmove":"mousemove",EVENT_OVER:CM.isiOS?"touchstart":"mouseover",EVENT_OUT:CM.isiOS?"touchstart":"mouseout",EVENT_CHANGE:"change",checkIntersectsInterval:null,dblclickTimeout:null,addDroppable:function(a){this.droppables.push(a)},addDraggable:function(a){this.draggables.push(a)},emptyElements:function(){this.draggables.length&&
this.draggables.splice(0,this.draggables.length);this.droppables.length&&this.droppables.splice(0,this.droppables.length)},setDraggingElement:function(a,b){this.draggingElt=a;var c=a.jQueryElt.offset();this.gap={x:b.pageX-c.left,y:b.pageY-c.top};this.parentOffset=a.jQueryElt.offsetParent().offset()},toggleDragging:function(){this.dragging=!this.dragging},checkIntersect:function(){var a=null,a=this.draggingElt.jQueryElt,b=a.position().left,c=b+this.draggingElt.width,d=a.position().top,e=d+this.draggingElt.height,
f=x21=y11=y21=0,g=!1;this.overElt=null;for(var h=0,k=this.droppables.length;h<k;h++)if(a=this.droppables[h],this.draggingElt!==a&&a.dropEnabled&&(f=a.position.x1,x21=a.position.x2,y11=a.position.y1,y21=a.position.y2,c>f+20&&b<f||b>f&&b<x21-20))if(d>y11&&d<y21||d<y11&&e>y11)this.overElt=a,g=!0;return g},initIntersect:function(){this.checkIntersectsInterval=setInterval(jQuery.proxy(this.checkIntersect,this),100)},clearIntersect:function(){clearInterval(this.checkIntersectsInterval);this.checkIntersectsInterval=
null},preventTouchDefaults:function(){CM.isiOS&&jQuery("body").bind(this.EVENT_MOVE+" "+this.EVENT_UP+" "+this.EVENT_DOWN,function(a){a.preventDefault()})},init:function(){var a=this;this.preventTouchDefaults();var b=jQuery.proxy(function(){if(this.draggingElt){var b=this.draggingElt;if(this.dragging)if(this.dragging=!1,this.checkIntersect())b.onStoppedDragging(),this.overElt.onOut(b),this.overElt.onDropping(b);else{if(b.onCancelDragging)b.onCancelDragging()}else if(this.dblclickTimeout===null){if(b.onClick)b.onClick();
this.dblclickTimeout=setTimeout(function(){a.dblclickTimeout=null},DBLCLICK_DELAY)}else if(b.onDoubleClick)b.onDoubleClick();this.draggingElt=null}},a);$(document).bind(this.EVENT_UP,b);b=jQuery.proxy(function(a){if(this.draggingElt&&this.draggingElt.dragEnabled){var b=this.draggingElt;if(this.dragging)b.onDragging&&(a=CM.isiOS?a.originalEvent.touches[0]:a.originalEvent,b.onDragging(a.pageX-this.gap.x-this.parentOffset.left,a.pageY-this.gap.y-this.parentOffset.top));else if(this.dragging=!0,b.onStartDragging)b.onStartDragging()}},
this);$(document).bind(this.EVENT_MOVE,b)}};function Card(a,b,c){this.color=0;this.status=ST_UNSELECTED;this.number=b;this.colorNumber=0;this.cardtype=a;this.visible=this.selectable=!1;this.deck=null;this.position={x:0,y:0};this.jQueryElt=jQuery("<div/>");this.zIndex=0;this.dblclickTimeout=null;this.dropEnabled=this.dragEnabled=this.dragging=!1;this.oldCssPosition=null;this.deckNum=this.height=this.width=0;if(typeof c!==void 0)for(var d in c)this[d]=c[d];this.init()}
Card.prototype.init=function(){this.colorNumber=this.number%13;if(this.colorNumber===0&&this.cardtype.indexOf("ace")<0)this.colorNumber=13;switch(this.cardtype){case "club":case "spade":this.color=BLACK;break;case "diamond":case "heart":this.color=RED;break;default:this.color=ANY}this.jQueryElt.addClass("card").removeClass("visible");this.visible===!0?(this.jQueryElt.css({cursor:"pointer"}),this.cardtype.indexOf("ace")>-1?this.jQueryElt.removeClass("card").addClass("pack "+this.cardtype).addClass("visible"):
this.cardtype=="king"?this.jQueryElt.removeClass("card").addClass("pack king").addClass("visible"):this.jQueryElt.css("background-position",-(game.spriteXStart+(this.colorNumber-1)*game.xSpace)+"px -"+game.backsY[this.cardtype]+"px")):this.jQueryElt.css("background-position","-"+game.cardBackX+"px -"+game.backYMisc+"px");this.jQueryElt.appendTo("#playground");this.width=this.jQueryElt.width();this.height=this.jQueryElt.height();this.position={x1:this.jQueryElt.position().left,y1:this.jQueryElt.position().top,
x2:this.jQueryElt.position().left+this.jQueryElt.width(),y2:this.jQueryElt.position().top+this.jQueryElt.height()}};Card.prototype.setDeckNum=function(a){this.deckNum=a};Card.prototype.getDeckNum=function(){return this.deckNum};Card.prototype.setDeck=function(a){this.deck=a};Card.prototype.getDeck=function(){return this.deck};Card.prototype.setCard=function(a){this.color=a.color;this.number=a.number;this.type=a.type};Card.prototype.getCard=function(){return{color:this.color,number:this.number,cardtype:this.cardtype}};
Card.prototype.getColorNumber=function(){return this.colorNumber};Card.prototype.getColor=function(){return this.color};Card.prototype.setColor=function(a){this.color=a};Card.prototype.setNumber=function(a){this.number=a};Card.prototype.getNumber=function(){return this.number};Card.prototype.setCardType=function(a){this.cardtype=a};
Card.prototype.setVisible=function(a){var b=this;this.visible=a;this.visible===!0?(this.jQueryElt.removeClass("rotate").css({cursor:"pointer"}),setTimeout(function(){b.jQueryElt.addClass("rotate")},5),setTimeout(function(){b.jQueryElt.css("background-position",-(game.spriteXStart+(b.colorNumber-1)*game.xSpace)+"px -"+game.backsY[b.cardtype]+"px")},250),this.dropEnabled=this.dragEnabled=!0):(this.jQueryElt.css({"background-position":"-"+game.cardBackX+"px -"+game.backYMisc+"px",cursor:"normal"}),this.dropEnabled=
this.dragEnabled=!1)};Card.prototype.isVisible=function(){return this.visible};Card.prototype.getCardType=function(){return this.cardtype};Card.prototype.setStatus=function(a){this.status=a};Card.prototype.toggleStatus=function(){this.setStatus(this.status===ST_SELECTED?ST_UNSELECTED:ST_SELECTED)};Card.prototype.onClick=function(){game.clickCard(this)};Card.prototype.onDoubleClick=function(){var a=this.deck.getDeckType();(a===DECK_BOTTOM||a===DECK_WASTE&&this.deck.getTop()===this)&&game.addToAce(this)};
Card.prototype.onOver=function(a){this.deck!==null?this.deck.acceptCard(a)&&this.jQueryElt.css("opacity",0.5):game.bottomDecks[this.deckNum].acceptCard(a)&&this.jQueryElt.css("opacity",0.5)};Card.prototype.onOut=function(){this.jQueryElt.css("opacity",1)};Card.prototype.onStoppedDragging=function(){this.deck.toggleDragging(this,!1)};Card.prototype.onCancelDragging=function(){var a=this.deck;a.toggleDragging(this,!1);a.setOldPositionFromCard(this);setTimeout(function(){game.blockedSelection=!1},300)};
Card.prototype.onStartDragging=function(){game.blockedSelection=!0;this.deck.toggleDragging(this,!0)};Card.prototype.onDropping=function(a){var b=this.deck!==null?this.deck:game.bottomDecks[this.deckNum];if(b.acceptCard(a))game.cardPos={x:this.position.x,y:this.position.y},game.swapDeck(a,b),game.selectedCard=null;else a.onCancelDragging()};Card.prototype.onDragging=function(a,b){this.deck.setPositionFromCard(this,a,b)};
Card.prototype.toggleDragging=function(a){a?(this.jQueryElt.addClass("dragged"),game.maxDepth++,this.depth(game.maxDepth)):this.jQueryElt.removeClass("dragged")};Card.prototype.toggleSelected=function(){this.jQueryElt.toggleClass("selected")};Card.prototype.toggleMoving=function(){this.jQueryElt.removeClass("moving");this.jQueryElt.addClass("moving")};
Card.prototype.enableSelection=function(a){if(!(this.selectable===a||typeof a!=="boolean"))this.selectable=a,this.selectable===!0?this.jQueryElt.bind(EventsManager.EVENT_DOWN,jQuery.proxy(function(a){if(!(game.blockedSelection===!0||a.button&&a.button!==0))this.oldCssPosition={left:this.jQueryElt.css("left"),top:this.jQueryElt.css("top")},EventsManager.setDraggingElement(this,CM.isiOS?a.originalEvent.touches[0]:a)},this)):this.jQueryElt.unbind(EventsManager.EVENT_DOWN)};
Card.prototype.enableDragAndDrop=function(a,b){if(a!==null)this.dragEnabled=a;if(b!==null)this.dropEnabled=b};Card.prototype.toString=function(){return this.colorNumber+" de "+this.cardtype};
Card.prototype.setPosition=function(a,b,c,d){var e=this.position,f=this;typeof c!=="undefined"?a===null?this.jQueryElt.addClass("visible"):(e.x=c,e.y=d,this.jQueryElt.css({top:b+"px",left:a+"px"}),this.jQueryElt.addClass("visible"),setTimeout(function(){f.jQueryElt.css({top:d+"px",left:c+"px"})},25)):a!=null?(e.x=a,e.y=b,this.jQueryElt.addClass("visible").css({top:e.y+"px",left:e.x+"px"})):this.jQueryElt.addClass("visible");e.x1=e.x;e.y1=e.y;e.x2=e.x1+this.width;e.y2=e.y1+this.height;if(this.oldCssPosition==
null)this.oldCssPosition={left:e.x+"px",top:e.y+"px"}};Card.prototype.saveOldPosition=function(a,b){this.oldCssPosition={left:a+"px",top:b+"px"}};Card.prototype.setOldPosition=function(){var a=this.position;a.x1=a.x=parseInt(this.oldCssPosition.left);a.y1=a.y=parseInt(this.oldCssPosition.top);a.x2=a.x1+this.width;a.y2=a.y1+this.height;this.jQueryElt.css(this.oldCssPosition)};Card.prototype.getPosition=function(){return this.position};Card.prototype.hide=function(){this.jQueryElt.removeClass("visible")};
Card.prototype.depth=function(a){if(typeof a==="undefined"||this.zIndex>a)return this.zIndex;else this.zIndex=a,this.jQueryElt.css("z-index",this.zIndex)};Card.prototype.getStateInfo=function(){return{number:this.number,cardtype:this.cardtype,visible:this.visible}};function isArray(a){return!!(a&&a.constructor==Array)}function Deck(a,b){this.cards=[];this.length=0;this.deckType=a;this.deckNum=typeof b!=="undefined"?b:0;this.topCard=null;this.init()}
Deck.prototype.init=function(){var a=this.deckType;if(a>1&&a<6){a-=2;var b=0;this.topCard=new Card("ace"+a,0,{visible:!0});this.topCard.setDeck(this);EventsManager.addDroppable(this.topCard);b=game.acePosX+a*game.aceSpace;this.topCard.setPosition(b,game.wastePosY)}else if(a===DECK_BOTTOM)this.topCard=new Card("king",0,{visible:!0}),this.topCard.setPosition(game.xStart+this.deckNum*(game.xSpace+game.packCardSpace),game.mainDeckY),this.topCard.setDeck(this)};
Deck.prototype.bindTopListeners=function(a){EventsManager.addDroppable(this.topCard);this.topCard.enableDragAndDrop(!1,!0);this.topCard.onDoubleClick=null;if(a===DECK_BOTTOM)this.topCard.onClick=game.touchMode===!1?function(){game.cardPos={x:parseInt(this.jQueryElt.css("left")),y:parseInt(this.jQueryElt.css("top"))};game.clickKing(this.deckNum,DECK_BOTTOM);return!1}:null,this.topCard.enableSelection(!0);else{var b=this.deckNum;jQuery(this.topCard.jQueryElt).data("deck",this.deckNum);game.touchMode===
!1&&jQuery(this.topCard.jQueryElt).bind(EventsManager.EVENT_UP,function(){game.cardPos={x:parseInt(jQuery(this).css("left")),y:parseInt(jQuery(this).css("top"))};game.clickKing(jQuery(this).data("deck"),b+2);return!1})}};Deck.prototype.setDeckNum=function(a){this.deckNum=a};Deck.prototype.getDeckNum=function(){return this.deckNum};Deck.prototype.getDeckType=function(){return this.deckType};
Deck.prototype.debug=function(){for(var a="",b=0,c=this.length,d=null,e=this.cards;b<=c-1;)d=e[b],a+=d.getNumber()+" ("+d.isVisible()+") ",b++};Deck.prototype.push=function(a){var b=this.cards;if(isArray(a)){for(var c=a.length,d=null,e=0;e<c;e++)d=a[e],d.setDeck(this),b.push(d);this.length+=a.length}else a.setDeck(this),b.push(a),this.length++};Deck.prototype.getTop=function(){var a=this.length;return a?this.cards[a-1]:null};
Deck.prototype.toggleSelectionFromCard=function(a){for(var b=0,c=!1,d=0,e=this.cards,d=e.length;b<d;){if(e[b]===a){c=!0;break}b++}if(c===!0)for(;b<d;)e[b].toggleSelected(),b++};Deck.prototype.toggleDragging=function(a,b){var c=0;for(found=!1,max=this.cards.length,cards=this.cards;c<max;){if(cards[c]===a){found=!0;break}c++}for(;c<max;c++)cards[c].toggleDragging(b)};
Deck.prototype.setOldPositionFromCard=function(a){for(var b=0,c=this.cards.length,d=this.cards;b<c;){if(d[b]===a)break;b++}for(a=c-1;a>=b;a--)d[a].setOldPosition()};Deck.prototype.setPositionFromCard=function(a,b,c){for(var d=0,e=0,f=this.cards.length,g=this.cards;d<f;){if(g[d]===a)break;d++}for(a=d;a<f;a++)g[a].setPosition(b,c+game.visibleCardSpace*e++)};
Deck.prototype.toggleMovingFromCard=function(a){for(var b=0,c=!1,d=this.cards.length,e=this.cards;b<d;){if(e[b]===a){c=!0;break}b++}if(c===!0)for(;b<d;)e[b].toggleMoving(),b++};Deck.prototype.popMultiple=function(a){var b=0,c=[];if(b=this.length){a>b&&(a=b);for(b=0;b<a;b++)c.push(this.pop());return c}else return null};Deck.prototype.pop=function(){return this.length?(this.length--,this.cards[this.length].setDeck(null),this.cards.pop()):null};
Deck.prototype.reverseFirstInvisible=function(){for(var a=this.cards,b=a.length-1;b>=0;b++){var c=a[b];if(c.isVisible()==!1){c.setVisible(!0);break}}};Deck.prototype.setPossibleSelections=function(){for(var a=this.length-1,b=a,c=null,d=this.cards;b>=0&&d[b].isVisible();)c=d[b],c.enableSelection(!0),c.enableDragAndDrop(!0,!1),b--;this.length&&d[a].isVisible()&&d[a].enableDragAndDrop(!0,!0);this.length>0&&this.getTop().isVisible()===!1&&d[a].enableSelection(!0);return this};
Deck.prototype.popVisible=function(a){for(var b=this.cards,c=b.length-1,d=[];c>=0&&b[c].isVisible()==!0;)d.push(this.pop()),c--;b.length&&a==!0&&b[this.length-1].setVisible(!0);return d.reverse()};Deck.prototype.popVisibleUpTo=function(a,b){for(var c=this.cards,d=c.length-1,e=[],f=!1;d>=0&&c[d].isVisible()==!0&&f===!1;)c[d]===a&&(f=!0),e.push(this.pop()),d--;c.length&&b==!0&&c[this.length-1].isVisible()===!1&&c[this.length-1].setVisible(!0);return e.reverse()};
Deck.prototype.popToBack=function(){if(!(this.length<=1)){var a=this.cards,b=a.pop(),c=a.length;b.setVisible(!1);b.hide();c&&(a[c-1].setVisible(!0),a[c-1].enableSelection(!0),a.splice(0,0,b))}};Deck.prototype.isTop=function(a){var b=this.cards,c=b.length;return c>0&&b[c-1]===a};
Deck.prototype.acceptCard=function(a){var b=this.deckType,c=this.getTop();if(b==DECK_BOTTOM)if(this.length===0){if(a.getColorNumber()==13)return!0}else return a.getColor()===c.getColor()?!1:c.getColorNumber()-a.getColorNumber()===1;else if(a===a.getDeck().getTop())if(b==DECK_ACE_HEART)return colorNum=c!==null?c.getColorNumber():0,a.getColorNumber()==0?a.getCardType()==="ace0":a.getCardType()==="heart"&&a.getColorNumber()-colorNum==1;else if(b==DECK_ACE_DIAMOND)return colorNum=c!==null?c.getColorNumber():
0,a.getColorNumber()==0?a.getCardType()==="ace1":a.getCardType()==="diamond"&&a.getColorNumber()-colorNum==1;else if(b==DECK_ACE_SPADE)return colorNum=c!==null?c.getColorNumber():0,a.getColorNumber()==0?a.getCardType()==="ace2":a.getCardType()==="spade"&&a.getColorNumber()-colorNum==1;else{if(b==DECK_ACE_CLUB)return colorNum=c!==null?c.getColorNumber():0,a.getColorNumber()==0?a.getCardType()==="ace3":a.getCardType()==="club"&&a.getColorNumber()-colorNum==1}else if(b==DECK_PACK)return!1};
Deck.prototype.getCardsFromDeck=function(a){for(card=a.pop();card!==null;)card.hide(),this.push(card),card=a.pop()};Deck.prototype.getCardAtPos=function(a){return a>=this.cards.length||a<0?null:this.cards[a]};Deck.prototype.showCards=function(a,b){for(var c=0,d=this.cards,e=this.length;c<e;)d[c].depth(c+2),d[c].setPosition(a,b),c++};Deck.prototype.toString=function(){return this.deckType};Deck.prototype.setCardsVisibility=function(a){for(var b=this.cards,c=0,d=this.length;c<d;c++)b[c].setVisible(a)};
Deck.prototype.getCardStates=function(){for(var a=[],b=this.cards,c=b.length,d=0;d<c;d++)a.push(b[d].getStateInfo());return a};Deck.prototype.fillWith=function(a){for(var b=a.length,c=null,d=0;d<b;d++)c=new Card(a[d].cardtype,a[d].number),c.setVisible(a[d].visible),EventsManager.addDroppable(c),EventsManager.addDraggable(c),this.push(c);return this};jQuery.fn.shake=function(a,b,c){this.each(function(){for(var d=parseInt(jQuery(this).css("left"),10),e=1;e<=a;e++)jQuery(this).animate({left:d-b*-1},c/a/4).animate({left:d+b},c/a/2).animate({left:d},c/a/4)});return this};function Random(a){return Math.floor(Math.random()*a+1)};function randRange(a,b){return randomNum=Math.floor(Math.random()*(b-a+1))+a}function Fly(a,b){this.x=a;this.y=b;this.flocon=jQuery("<div/>").css({opacity:0}).appendTo("#playground");this.nextParticle=null;this.visible=!0;var c=randRange(0,30);c<10?this.flocon.addClass("particle1"):c<20?this.flocon.addClass("particle2"):this.flocon.addClass("particle3");this.maxX=-48}
Fly.prototype.move=function(){if(this.visible){this.a+=Math.random()*0.1-0.05;this.a*=0.9;this.angle+=this.a;this.y+=Math.abs(Math.sin(this.angle)*2);this.x+=Math.cos(this.angle)*5;var a=this.x,b=this.y;if(a>1E3||a<this.maxX||b>800||b<0)this.hide();else{if(this.off==!0)if(this.alpha>0)this.alpha-=0.02;else{this.hide();return}else this.alpha<1&&(this.alpha+=0.05);this.flocon.css({left:a+"px",top:b+"px",opacity:this.alpha})}}};
Fly.prototype.hide=function(){this.visible=!1;this.flocon.css("opacity",0)};Fly.prototype.setPos=function(a,b){this.x=a;this.y=b;return this};Fly.prototype.init=function(){this.a=0;this.alpha=1;this.off=!0;this.angle=-1.55;this.visible=!0;this.flocon.css({left:this.x+"px",top:this.y+"px",opacity:this.alpha});this.angle=-1.55};
var Particles={ctx:null,interval:null,firstParticle:null,maxFly:0,init:function(a){this.maxFly=a;for(var b=this.firstParticle=new Fly(0,0),c=0;c<a;c++)b.nextParticle=new Fly(0,0),b=b.nextParticle,b.nextParticle=new Fly(0,0),b=b.nextParticle,b.nextParticle=new Fly(0,0),b=b.nextParticle,b.nextParticle=new Fly(0,0),b=b.nextParticle},updateParticles:function(){for(var a=0,b=this.firstParticle;b;)b.visible&&(b.move(),a++),b=b.nextParticle;if(a==0)clearInterval(this.interval),this.interval=null},launchParticles:function(a){var b=
a.x-20,c=a.x+90,d=a.y-10,a=a.y+126,e=this.firstParticle;if(this.interval)clearInterval(this.interval),this.interval=null;for(;e;)e.x=randRange(b,c),e.y=randRange(d,a),e.init(),e=e.nextParticle;this.interval=setInterval(jQuery.proxy(this.updateParticles,this),30)}};var BLACK=1,RED=2,ANY=3,ST_SELECTED=3,ST_UNSELECTED=4,G_INIT=1,G_RUNNING=2,G_STOPPED=3,G_PAUSED=4,RULES=[1,2,3,4,5,6,7],MAX_CARDS=7,DISPLAY_POSITIONS={pre:{SPRITE_XSTART:47,XSTART:47,XSPACE:55,CARDBACK:{x:377,y:280},BACKSY:{heart:0,diamond:70,club:140,spade:210,misc:280},MAIN_DECK_Y:112,WASTEPOS:{x:47,y:26},ACESPOS:{x:210,space:54},VISIBLE_CARD_SPACE:14,HIDDEN_CARD_SPACE:6,PACK_CARD_SPACE:36},hd:{SPRITE_XSTART:47,XSTART:100,XSPACE:88,CARDBACK:{x:487,y:280},BACKSY:{heart:3,diamond:113,club:223,spade:332,
misc:441},MAIN_DECK_Y:280,WASTEPOS:{x:140,y:66},ACESPOS:{x:438,space:120},VISIBLE_CARD_SPACE:18,HIDDEN_CARD_SPACE:6,PACK_CARD_SPACE:36},pixi:{SPRITE_XSTART:47,XSTART:10,XSPACE:55,CARDBACK:{x:377,y:280},BACKSY:{heart:0,diamond:70,club:140,spade:210,misc:280},MAIN_DECK_Y:112,WASTEPOS:{x:10,y:26},ACESPOS:{x:173,space:54},VISIBLE_CARD_SPACE:14,HIDDEN_CARD_SPACE:6,PACK_CARD_SPACE:36}},SHUFFLE_TRANSLATION=800,SWAP_TRANSLATION=100,DBLCLICK_DELAY=270,DECK_PACK=1,DECK_ACE_HEART=2,DECK_ACE_DIAMOND=3,DECK_ACE_CLUB=
4,DECK_ACE_SPADE=5,DECK_ACES=6,DECK_BOTTOM=7,DECK_WASTE=8,NUM_CARDS=52,game={stockPack:new Deck(DECK_PACK),wastePack:new Deck(DECK_WASTE),aceDecks:[],bottomDecks:[],score:0,scores:null,scorePosition:-1,scoreObj:{},playAttempts:0,gameStats:{},gameOptions:{},touchMode:!0,time:{h:0,m:0,s:0},selectedCard:null,multiSelect:!1,cardPos:null,maxDepth:1,statusPanelElt:null,optionsPanelElt:null,timeElt:null,scoreElt:null,stackElt:null,pauseElt:null,scoreEvolElt:null,blockedSelection:!1,blockedPack:!1,displayPositions:null,
history:[],init:function(a,b,c){this.statusPanelElt=jQuery("#statusPanel");this.optionsPanelElt=jQuery("#optionsPanel");this.timeElt=jQuery("#statusPanel").find(".time");this.scoreElt=jQuery("#statusPanel").find(".score");this.stackElt=jQuery('<div class="waste returnedCard visible"/>').appendTo("#playground");this.pauseElt=jQuery("#playground #pause");this.scoreEvolElt=jQuery('<div class="scoreEvol"/>').appendTo("body");this.gameOptions={sound:a.sound,background:a.background,cardset:a.cardset,theme:a.theme,
autoFlip:a.autoFlip,autoPlay:a.autoPlay};this.gameStats={status:b.status,date:b.date,gamesTotal:b.gamesTotal,gamesWon:b.gamesWon,scoreTotal:b.scoreTotal};this.scores=c;this.displayPositions=DISPLAY_POSITIONS[CM.phoneType];this.wastePosX=this.displayPositions.WASTEPOS.x;this.wastePosY=this.displayPositions.WASTEPOS.y;this.acePosX=this.displayPositions.ACESPOS.x;this.acePosY=this.displayPositions.ACESPOS.y;this.aceSpace=this.displayPositions.ACESPOS.space;this.xSpace=this.displayPositions.XSPACE;this.backYHeart=
this.displayPositions.BACKSY.heart;this.backYSpade=this.displayPositions.BACKSY.spade;this.backYDiamond=this.displayPositions.BACKSY.diamond;this.backYSpade=this.displayPositions.BACKSY.spade;this.backYMisc=this.displayPositions.BACKSY.misc;this.backsY=this.displayPositions.BACKSY;this.xStart=this.displayPositions.XSTART;this.visibleCardSpace=this.displayPositions.VISIBLE_CARD_SPACE;this.hiddenCardSpace=this.displayPositions.HIDDEN_CARD_SPACE;this.mainDeckY=this.displayPositions.MAIN_DECK_Y;this.packCardSpace=
this.displayPositions.PACK_CARD_SPACE;this.spriteXStart=this.displayPositions.SPRITE_XSTART;this.cardBackX=this.displayPositions.CARDBACK.x;this.cardBackY=this.displayPositions.CARDBACK.y;CM.phoneType==="pixi"?jQuery("body").addClass("pixi"):CM.phoneType==="hd"&&jQuery("body").addClass("hd");TimerManager.init(jQuery.proxy(this.updateTime,this));this.time={h:0,m:0,s:0};this.setupListeners()},shuffle:function(){var a=Array(NUM_CARDS);this.stockPack=new Deck(DECK_PACK);this.wastePack=new Deck(DECK_WASTE);
this.aceDecks=[new Deck(DECK_ACE_HEART),new Deck(DECK_ACE_DIAMOND),new Deck(DECK_ACE_SPADE),new Deck(DECK_ACE_CLUB)];for(var b=this.bottomDecks=[new Deck(DECK_BOTTOM,0),new Deck(DECK_BOTTOM,1),new Deck(DECK_BOTTOM,2),new Deck(DECK_BOTTOM,3),new Deck(DECK_BOTTOM,4),new Deck(DECK_BOTTOM,5),new Deck(DECK_BOTTOM,6)],c=this.stockPack,d=0,e=b.length;d<e;d++)b[d].setDeckNum(d);SoundManager.playSound(SND_SHUFFLE);for(d=0;d<NUM_CARDS;d++)a[d]=0;for(d=0;d<NUM_CARDS;d++){for(var f=Random(NUM_CARDS),e=null;a[f]===
1;)f=Random(NUM_CARDS);a[f]=1;couleur=f<27?BLACK:RED;cardtype="heart";f<14?cardtype="spade":f<27?cardtype="club":f<40&&(cardtype="diamond");e=new Card(cardtype,f);EventsManager.addDroppable(e);EventsManager.addDraggable(e);c.push(e)}for(a=1;a<=MAX_CARDS;){for(d=0;d<RULES.length;d++)a>RULES[d]||(e=c.pop(),a==RULES[d]&&(e.setVisible(!0),e.enableSelection(!0)),b[d].push(e));a++}d=0;for(e=b.length;d<e;d++)b[d].bindTopListeners(DECK_BOTTOM);d=0;for(e=this.aceDecks.length;d<e;d++)this.aceDecks[d].bindTopListeners(-1);
this.playAttempts++;this.gameStats.gamesTotal++},resumeGame:function(a){a=a.value;this.selectedCard!==null&&this.toggleSelectedCard(this.selectedCard);this.selectedCard=null;this.multiSelect=0;jQuery(".card").remove();jQuery(".pack").remove();EventsManager.emptyElements();this.stockPack=new Deck(DECK_PACK);this.wastePack=new Deck(DECK_WASTE);this.aceDecks=[new Deck(DECK_ACE_HEART),new Deck(DECK_ACE_DIAMOND),new Deck(DECK_ACE_SPADE),new Deck(DECK_ACE_CLUB)];var b=this.bottomDecks=[new Deck(DECK_BOTTOM,
0),new Deck(DECK_BOTTOM,1),new Deck(DECK_BOTTOM,2),new Deck(DECK_BOTTOM,3),new Deck(DECK_BOTTOM,4),new Deck(DECK_BOTTOM,5),new Deck(DECK_BOTTOM,6)],c=this.aceDecks;this.stockPack.fillWith(a.pack);this.stockPack.length||this.stackElt.addClass("empty");this.wastePack.fillWith(a.wasteDeck).setPossibleSelections().showCards(this.wastePosX+(this.xSpace+10),this.wastePosY);this.setWasteShadow();c[0].fillWith(a.heartDeck).setPossibleSelections().showCards(this.acePosX,this.wastePosY);c[1].fillWith(a.diamondDeck).setPossibleSelections().showCards(this.acePosX+
this.aceSpace,this.wastePosY);c[3].fillWith(a.spadeDeck).setPossibleSelections().showCards(this.acePosX+2*this.aceSpace,this.wastePosY);c[2].fillWith(a.clubDeck).setPossibleSelections().showCards(this.acePosX+3*this.aceSpace,this.wastePosY);for(var d=b.length,e=0;e<d;e++)b[e].fillWith(a.bottomDecks[e]).setPossibleSelections();for(e=0;e<d;e++)b[e].bindTopListeners(DECK_BOTTOM);e=0;for(b=c.length;e<b;e++)c[e].bindTopListeners(-1);this.time=a.time;this.score=a.score;this.updateScore();this.runGame()},
initGraphics:function(){this.showCards();this.statusPanelElt.slideDown();this.optionsPanelElt.slideDown();this.stackElt.css({left:this.wastePosX+"px",top:this.wastePosY+"px"})},showCards:function(){for(var a=this.xSpace+this.packCardSpace,b=this.mainDeckY,c=this.xStart,d=this.visibleCardSpace,e=this.hiddenCardSpace,f=this.bottomDecks,g=0;g<RULES.length;g++)for(var h=f[g],k=h.length,j=0,l=0;l<k;l++){var m=h.getCardAtPos(l);m.depth(g*MAX_CARDS+l+2);m.setPosition(c+g*a,b+j);m.isVisible()?(j+=d,m.enableSelection(!0)):
j+=e}this.maxDepth=RULES.length*MAX_CARDS+l;this.setWasteShadow()},setupListeners:function(){var a=this,b=this.gameStats;jQuery("#statusPanel .startAgain").bind(EventsManager.EVENT_UP,jQuery.proxy(this.restart,this));jQuery(".restoreGame").live(EventsManager.EVENT_UP,function(){game.loadState();$.gritter.removeAll();return!1});$("#youWon .ok").click(function(){if(a.scorePosition>-1==!0)a.scoreObj.nick=$("#youWon input").val(),StateManager.setScore(a.scoreObj,a.scorePosition),a.scores[i]=a.scoreObj;
$("#tweetScore").hasClass("checked")&&window.open(CM.twitterURL+encodeURIComponent("I just did the impossible score of #{score} at SolitaireHD by @warpdesign_ :) Do you think you can do better ? ;) \u2192 http://bit.ly/1FYjhbH".replace("#{score}",a.scoreObj.score)),"I am a winner, and I don't use drugs ;)","width=550,height=380,top="+(screen.height-380)/2+",left="+(screen.width-550)/2);WarpKlondikeMain.setScores(a.scores);setTimeout(function(){$("#showScores").trigger(EventsManager.EVENT_UP)},1E3);return!1});
this.stackElt.bind(EventsManager.EVENT_UP,jQuery.proxy(this.nextPackCard,this));jQuery(window).bind("blur",function(){a.togglePauseGame(!0)});jQuery(window).bind("focus",function(){a.togglePauseGame()});$("#undo").click(jQuery.proxy(this.popHistory,this));jQuery(window).bind("unload",function(){a.saveState();b.status=G_PAUSED;b.date=(new Date).toUTCString();StateManager.setStatus(b)})},restart:function(){this.selectedCard!==null&&this.toggleSelectedCard(this.selectedCard);this.selectedCard=null;this.score=
this.multiSelect=0;this.highScore=!1;this.scoreObj={};this.updateScore();jQuery(".card").remove();jQuery(".pack").remove();this.stackElt.removeClass("empty");this.setWasteShadow();this.flushHistory();EventsManager.emptyElements();this.shuffle();this.time.h=this.time.m=this.time.s=0;this.runGame()},runGame:function(){this.initGraphics();TimerManager.stop();TimerManager.start(this.time);this.gameStats.status=G_RUNNING},pauseGame:function(){this.gameStats.status=G_PAUSED},unpauseGame:function(){this.gameStats.status=
G_RUNNING},updateTime:function(a){this.time=a;this.timeElt.html((a.m>9?a.m:"0"+a.m)+" : "+(a.s>9?a.s:"0"+a.s));a=this.aceDecks;a[0].length==13&&a[1].length==13&&a[2].length==13&&a[3].length==13&&this.endGameWon()},flashScore:function(a){var b=this.scoreEvolElt;b.hasClass("shown")&&b.removeClass("shown");b.html((a>0?"+":"-")+a);setTimeout(function(){b.addClass("shown")},100)},updateScore:function(a,b){var c=this.scoreEvolElt;if(typeof a!=="undefined"){c.hasClass("shown")&&c.removeClass("shown");switch(a){case DECK_BOTTOM:b!==
DECK_BOTTOM&&(this.score+=10,c.html("+ 10"));break;case DECK_WASTE:b===DECK_BOTTOM?(this.score+=5,c.html("+ 5")):(this.score+=10,c.html("+ 10"));break;default:this.score-=15,c.html("- 15")}setTimeout(function(){c.addClass("shown")},100)}this.scoreElt.html(this.score+" points")},clickKing:function(a,b){if(!(this.selectedCard===null||b!==DECK_BOTTOM&&this.multiSelect===!0))if(selectedDeck=b===DECK_BOTTOM?this.bottomDecks[a]:this.aceDecks[a],selectedDeck.acceptCard(this.selectedCard))SoundManager.playSound(SND_FLICK_CARD),
this.toggleSelectedCard(this.selectedCard),this.swapDeck(this.selectedCard,selectedDeck),this.selectedCard=null},toggleSelectedCard:function(a){a!==null&&a.getDeck().toggleSelectionFromCard(a)},clickCard:function(a){if(this.blockedSelection!==!0){var b=this.selectedCard;if(a!=null&&b!==a){if(this.touchMode===!1&&b!==null)a.getDeck().acceptCard(b)?(SoundManager.playSound(SND_FLICK_CARD),this.toggleSelectedCard(b),this.swapDeck(b,a.getDeck()),a=null):a=b;else if(a.isVisible()){if(this.touchMode===!1)SoundManager.playSound(SND_CLICK_CARD),
this.toggleSelectedCard(a),this.multiSelect=a.getDeck().getTop()===a?!1:!0}else this.score+=5,this.updateScore(),a.setVisible(!0),a=null,this.autoPlay();this.touchMode===!0&&a!==b&&a!==null&&a.toggleStatus()}else this.touchMode===!1&&(b&&(SoundManager.playSound(SND_CLICK_CARD),b.setStatus(ST_UNSELECTED)),a.getDeck().toggleSelectionFromCard(a),a=null);if(this.touchMode===!1)this.selectedCard=a}},swapDeck:function(a,b,c){var d=this;this.blockedSelection=!0;var e=a.getDeck(),f=0,g={},h=null;c||this.pushHistory("move",
a,e);b.getTop()!==null?(g=b.getTop().getPosition(),f=this.visibleCardSpace):(g=c?b.topCard.getPosition():this.cardPos,f=0);h=e.isTop(a)!=!0?e.popVisibleUpTo(a,!1):[e.pop()];this.maxDepth++;if(b.getDeckType()!==DECK_BOTTOM)f=0;else if(c&&b.getTop())f=this.hiddenCardSpace;this.updateScore(e.getDeckType(),b.getDeckType());b.push(h);for(var c=this.visibleCardSpace,k=h.length,j=0;j<k;j++)cardToMove=h[j],cardToMove.setPosition(g.x,g.y+f),cardToMove.depth(this.maxDepth++),cardToMove.saveOldPosition(g.x,
g.y+f),f+=c;e.getTop()&&e.getTop().isVisible()===!1&&this.gameOptions.autoFlip&&(this.pushHistory("toggle",e.reverseFirstInvisible(),null),this.score+=5,this.updateScore());e.setPossibleSelections();b.setPossibleSelections();a.getDeck().getDeckType()>6?setTimeout(jQuery.proxy(this.autoPlay,this),500):a.getDeck().getDeckType()<6&&setTimeout(function(){Particles.launchParticles(g)},300);setTimeout(function(){d.blockedSelection=!1},350)},nextPackCard:function(){var a=0,b=this,c=this.wastePosX+this.xSpace+
10,d=0,a=this.selectedCard;if(this.blockedPack!==!0){this.blockedPack=!0;var e=this.stockPack.popMultiple(1);this.pushHistory("pack",e);if(a!==null&&a.getDeck()===this.wastePack)this.toggleSelectedCard(a),this.selectedCard=a=null;if(e!==null){for(var d=this.wastePack.getTop()?this.wastePack.getTop().depth()+1:2,f=e.length,g=this.visibleCardSpace,h=this.wastePosX,k=this.wastePosY,a=0;a<f;a++){var j=e[a];this.wastePack.push(j);j.setVisible(!0);j.enableSelection(!0);j.depth(d+a);j.setPosition(h,k,c+
a*g,k)}this.blockedSelection=!0;setTimeout(function(){b.blockedSelection=!1;b.autoPlay(!0)},400)}else this.stockPack.getCardsFromDeck(this.wastePack),this.stackElt.removeClass("empty"),this.stockPack.setCardsVisibility(!1);this.stockPack.length===0&&this.stackElt.addClass("empty");this.setWasteShadow();return this.blockedPack=!1}},setWasteShadow:function(){var a=this.stockPack.length;a>=18?this.stackElt.removeClass("half").removeClass("less").addClass("full"):a>=6?this.stackElt.removeClass("full").removeClass("less").addClass("half"):
this.stackElt.removeClass("half").removeClass("full").addClass("less")},pushHistory:function(a,b,c){this.history.push({type:a,card:b!==void 0?b:null,destinationDeck:c!==void 0?c:null})},popHistory:function(){if(this.history.length){var a=this.history.pop();a.type=="move"?this.swapDeck(a.card,a.destinationDeck,!0):a.type=="toggle"&&(a.card.setVisible(!1),this.gameOptions.autoFlip&&this.popHistory());return!1}},flushHistory:function(){this.history.splice(0,this.history.length)},autoPlay:function(a){if(this.gameOptions.autoPlay){var b=
!1,c=this.wastePack.getTop(),d=this.bottomDecks.length,e=this.bottomDecks,f=0;if(a===void 0)for(;f<d;)(a=e[f].getTop())&&a.isVisible()&&this.addToAce(a)&&(b=!0),f++;c&&c.isVisible()&&this.addToAce(c)&&(b=!0);b&&setTimeout(jQuery.proxy(this.autoPlay,this),500)}},saveState:function(){for(var a=0,b={pack:this.stockPack.getCardStates(),wasteDeck:this.wastePack.getCardStates(),heartDeck:this.aceDecks[0].getCardStates(),diamondDeck:this.aceDecks[1].getCardStates(),spadeDeck:this.aceDecks[3].getCardStates(),
clubDeck:this.aceDecks[2].getCardStates(),bottomDecks:[],score:this.score,time:this.time},c=this.bottomDecks,a=0;a<MAX_CARDS;a++)b.bottomDecks.push(c[a].getCardStates());StateManager.saveState(b)},loadState:function(){StateManager.loadState(jQuery.proxy(this.resumeGame,this))},addToAce:function(a){var b=null,c=0;switch(a.getCardType()){case "spade":b=this.aceDecks[2];c=3;break;case "diamond":b=this.aceDecks[1];c=1;break;case "heart":b=this.aceDecks[0];c=0;break;case "club":b=this.aceDecks[3],c=2}return b.acceptCard(a)?
(this.cardPos={x:this.acePosX+c*this.aceSpace,y:this.wastePosY},this.swapDeck(a,b),this.toggleSelectedCard(this.selectedCard),this.selectedCard=null,SoundManager.playSound(SND_FLICK_CARD),!0):!1},togglePauseGame:function(a){if(this.gameStats.status===G_PAUSED)TimerManager.start(this.time),this.gameStats.status=G_RUNNING;else if(a&&(TimerManager.stop(),this.gameStats.status==G_RUNNING))this.gameStats.status=G_PAUSED},endGameWon:function(){this.gameStats.status=G_STOPPED;SoundManager.playSound(SND_YOU_WIN);
TimerManager.stop();this.gameStats.gamesWon++;this.gameStats.scoreTotal+=this.score;this.scoreObj={nick:"",score:this.score,time:this.time,location:"Paris",date:(new Date).toUTCString()};this.scorePosition=-1;for(i=0;i<this.scores.length;i++)if(this.score>this.scores[i].score){this.scorePosition=i;break}$("#youWon span.score").text(this.score).focus();this.scorePosition==-1?($("#youWon input").hide(),$("#youWon p").hide()):($("#youWon input").show(),$("#youWon p").show());$(".dialog").center();$("#shadow").fadeIn("normal",
function(){$("#youWon").toggleClass("flipped");$("#youWon input").focus()})}};$.fn.center=function(){var a=window.innerWidth;return this.each(function(){$(this).css({left:(a-$(this).outerWidth())/2+"px"})})};
var WarpKlondikeMain=function(a){function b(){$("#playground").css("margin-top",parseInt((window.innerHeight-parseInt($("#playground").height()))/2)+"px");CM.isiOS&&$("#sound").hide();$("div.check").bind(EventsManager.EVENT_UP,function(){var b=$(this).attr("id");a.gameOptions[b]=!a.gameOptions[b];$(this).toggleClass("checked")});$(".ok").bind(EventsManager.EVENT_UP,function(){$(this).parent().parent().attr("id")==="options"&&(StateManager.setGameOptions(a.gameOptions),StateManager.saveGameOptions());
$(this).parents(".dialog").removeClass("flipped");$(".icon").removeClass("over");a.togglePauseGame(!1);$("#shadow").fadeOut()});$(".themeSelect").click(function(){var b=$(this).find("img").attr("alt");$("ul#themeList li").removeClass("selected");$(this).parent().addClass("selected");$("#themeCSS").attr("href","css/themes/"+b+"/theme.css");a.gameOptions.theme=b;return!1});$("#showScores").bind(EventsManager.EVENT_UP,function(){$(".dialog").center();$("#scores").hasClass("flipped")?a.togglePauseGame(!1):
a.togglePauseGame(!0);$("#options").removeClass("flipped");$("#shadow").fadeIn("normal",function(){$("#scores").toggleClass("flipped")});return!1});$("#menuToggle").bind(EventsManager.EVENT_UP,function(){$(".dialog").center();$("#scores").removeClass("flipped");$("#options").hasClass("flipped")?(StateManager.setGameOptions(a.gameOptions),StateManager.saveGameOptions(),a.togglePauseGame(!1)):a.togglePauseGame(!0);$(this).removeClass("over");$("#shadow").fadeIn("normal",function(){$("#options").toggleClass("flipped")});
return!1});CM.isiOS||$(".icon").bind(EventsManager.EVENT_OVER,function(){$(this).addClass("over")}).bind(EventsManager.EVENT_OUT,function(){$(this).removeClass("over")})}function c(){$("#splash").animate({opacity:0},500).delay(500).hide()}return{status:0,setStatus:function(a){this.status=a},init:function(){SoundManager.init();EventsManager.init();b();Particles.init(CM.isiOS?8:32);$("#splash .content").css("opacity","1");setTimeout(function(){},2901);setTimeout(c,3E3);StateManager.init("1.0",function(b,
c,f){a.init(b,c,f);a.gameStats.status==G_PAUSED&&setTimeout(function(){$.gritter.add({title:"Information",text:'A previous game state has been saved. Would you like to resume it ?<br /><br /><a class="restoreGame" href="#">Click here to restore it</a>',image:"img/hd/icons/brainstorming.png",time:7E3,fade_in_speed:"fast",fade_out_speed:400});navigator.userAgent.match("WebKit")||$.gritter.add({title:"Browser Information",text:"Seems like you're not using a WebKit Browser.<br />This version works better on WebKit",
image:"img/hd/icons/brainstorming.png",time:4E3,fade_in_speed:"fast",fade_out_speed:400})},4E3);a.shuffle();WarpKlondikeMain.setOptions();WarpKlondikeMain.setScores(f);a.runGame()})},setTheme:function(a){var b=$("#themeCSS");b.length?b.attr("href","css/themes/"+a+"/theme.css"):$("<link/>").attr({rel:"stylesheet",type:"text/css",href:"css/themes/"+a+"/theme.css",id:"themeCSS"}).appendTo("head");$("ul#themeList li").removeClass("selected");$("#themeList").find("img[alt="+a+"]").parent().parent().addClass("selected")},
setOptions:function(){a.gameOptions.autoFlip&&$("#autoFlip").addClass("checked");a.gameOptions.autoPlay&&$("#autoPlay").addClass("checked");a.gameOptions.sound&&$("#sound").addClass("checked");if(!a.gameOptions.theme)a.gameOptions.theme="fantasy";WarpKlondikeMain.setTheme(a.gameOptions.theme)},setScores:function(a){if(typeof a==="object"){var b=$("#scores ul");$("#scores ul li").remove();for(var c=0;c<a.length;c++)$("<li/>").append('<span class="rank">'+(c+1)+'</span><span class="nick">'+a[c].nick+
'</span><span class="score">'+a[c].score+"</span>").appendTo(b)}}}}(game);
